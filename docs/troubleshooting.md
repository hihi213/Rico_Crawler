# 트러블슈팅

- (작성 전) 발생한 이슈/증상/원인/해결을 간단히 기록
# Troubleshooting Log

## 2026-02-09: 첨부 등록일 파싱 실패

### 증상
- 첨부 메타 저장 시 `AttachmentItem.inpt_dt` 파싱 실패
- 로그에 `invalid date separator` 발생

### 원인
- 첨부 API 응답의 등록일 포맷이 `YYYY/MM/DD HH:mm:ss` 형태
- 기존 파서가 하이픈 포맷만 허용

### 해결
- `AttachmentItem.inpt_dt`에 공통 datetime 파서 적용
- 첨부 CSV 저장 재실행 후 정상 저장 확인

## 2026-02-09: 개찰 점수 필드 타입 불일치

### 증상
- `BidOpeningResult` 저장 시 점수 필드 타입 오류로 스킵 발생

### 원인
- `ibx_evl_scr_prpl/prce/ovrl`이 숫자(0)로 내려오는 케이스 존재
- 모델이 문자열만 허용해 검증 실패

### 해결
- 점수 필드를 문자열로 정규화하는 validator 추가
- 2페이지 재수집 결과 `opening_result.csv` 생성 확인

## 2026-02-09: 페이지 크기 100건 확대 영향

### 증상
- 2페이지 수집 시 레코드 수가 대폭 증가

### 원인
- `recordCountPerPage`를 100으로 설정해 페이지당 수집량 증가

### 해결
- 정상 동작 확인: 2페이지 기준 목록/상세 200건, 첨부/공지/개찰 요약/결과 저장 완료

## 2026-02-09: 날짜 입력 형식/범위 오류 가능성

### 증상
- `pbancPstgStDt/pbancPstgEdDt` 또는 `onbsPrnmntStDt/onbsPrnmntEdDt` 값이 잘못되면 API 오류 또는 빈 결과 발생

### 원인
- 날짜 형식이 `YYYYMMDD`가 아니거나 시작일이 종료일보다 늦은 경우

### 해결
- 페이로드 구성 단계에서 날짜 형식/범위를 사전 검증하도록 개선

## 2026-02-09: 상세 하위 리스트/맵 샘플 부족

### 증상
- `bidPbancItemlist` 등 하위 리스트/맵 스키마를 확정하지 못함

### 원인
- 크롬에서 확인한 상세 응답이 빈 필드로 내려오는 경우가 있어 스키마를 확정하기 어려움

### 해결
- 원본 JSON 스냅샷 저장 옵션을 추가해 후속 분석 가능하도록 설계
- 전체 저장이 아닌 "예상 외(새) 필드가 감지된 응답만 선택 저장"으로 제한
- 옵션으로 ON/OFF 가능하게 해 운영/분석 부담을 줄임
 - 현재 config에 옵션이 반영되어 적용 완료

## 2026-02-09: 목록 문서제출/이의신청 일시 파싱 실패

### 증상
- 목록 스냅샷 중 일부 행이 CSV에서 누락됨
- `doc_sbmsn_ddln_dt` / `objtdmd_term_dt` 파싱 오류

### 원인
- 일시가 `YYYYMMDDHHmmss`(구분자 없음)로 내려오는 케이스 존재
- 파서가 구분자 없는 일시 포맷을 허용하지 않음

### 해결
- 공통 datetime 파서에 `YYYYMMDDHHmmss`, `YYYYMMDDHHmm` 포맷 추가
- 목록 CSV 재생성 후 누락 0건 확인

## 2026-02-09: 기관명 HTML 엔티티 노출

### 증상
- `pbanc_inst_unty_grp_no_nm`, `grp_nm` 등에 `&#40;사&#41;한국프로축구연맹` 형태로 저장됨

### 원인
- 원본 응답의 HTML 엔티티를 그대로 저장해 표시용 텍스트가 깨짐

### 해결
- 문자열 필드에 HTML 엔티티 디코딩 적용
- 라이브 재수집(1페이지, 100건) 후 엔티티 미노출 확인

## 2026-02-09: 전 범위 필터 조합에서 HTML 엔티티 재발

### 증상
- 특정 필터 조합(모의공고/취소공고 등)에서 `edoc_no` 등 문자열에 `&#40;` 같은 HTML 엔티티가 재노출
- 개찰 요약/공지/첨부 등 다른 CSV에도 엔티티가 섞여 있음

### 원인
- 엔티티 디코딩을 일부 텍스트 필드에만 적용
- 문서번호(`edoc_no`, `usr_doc_no_val`) 및 첨부/공지 텍스트는 누락됨

### 해결
- 공통 문서번호 정규화에 엔티티 디코딩 포함
- 개찰 요약/결과, 공지, 첨부 텍스트 필드에 엔티티 디코딩 적용
- 실시간 공고 기준 필터 조합(2페이지) 재검증 → 엔티티 0건 확인

## 2026-02-09: 첨부 메타 업무분류 코드 누락

### 증상
- 첨부 API에서 `bsneClsfCd`가 `null`인 케이스 발생
- Pydantic 검증 실패로 첨부 행 스킵

### 원인
- `AttachmentItem.bsne_clsf_cd`가 필수(`str`)로 정의되어 있었음

### 해결
- `bsne_clsf_cd`를 선택 필드로 완화하여 스킵 방지
